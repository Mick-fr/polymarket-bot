{% extends "base.html" %}

{% block title %}Polymarket Bot V7.4{% endblock %}

{% block body %}
<style>
    /* â”€â”€ V7.4 Dashboard Overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
        --bg: #0a0a0a;
        --surface: #111114;
        --surface-2: #18181c;
        --border: #222228;
        --text: #f0f0f5;
        --text-dim: #888897;
        --accent: #a855f7;
        --accent-dim: rgba(168, 85, 247, 0.12);
        --green: #22c55e;
        --red: #ef4444;
        --orange: #f59e0b;
        --radius: 14px;
        --radius-sm: 8px;
    }

    body {
        background: var(--bg);
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .v74-header {
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 28px;
        background: rgba(10, 10, 10, 0.92);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--border);
    }

    .v74-logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .v74-logo-mark {
        width: 32px;
        height: 32px;
        background: var(--accent-dim);
        border: 1px solid rgba(168, 85, 247, 0.3);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 15px;
    }

    .v74-logo-text {
        font-weight: 700;
        font-size: 1rem;
        letter-spacing: -0.01em;
    }

    .v74-logo-ver {
        font-size: 0.7rem;
        color: var(--accent);
        background: var(--accent-dim);
        padding: 2px 7px;
        border-radius: 20px;
        font-weight: 600;
        margin-left: 6px;
    }

    .v74-header-right {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-wrap: wrap;
    }

    /* â”€â”€ Live badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .live-badge {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        border-radius: 20px;
        background: rgba(34, 197, 94, 0.08);
        border: 1px solid rgba(34, 197, 94, 0.2);
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--green);
    }

    .live-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--green);
        animation: pulse 1.8s infinite;
    }

    /* â”€â”€ Agressivity select â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .agg-select-wrap {
        position: relative;
    }

    .agg-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--accent);
        color: #fff;
        font-size: 0.55rem;
        font-weight: 700;
        padding: 1px 5px;
        border-radius: 6px;
        letter-spacing: 0.05em;
    }

    #agg-select {
        appearance: none;
        cursor: pointer;
        padding: 7px 28px 7px 12px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: var(--radius-sm);
        font-size: 0.82rem;
        font-weight: 500;
        transition: border-color 0.2s;
    }

    #agg-select:focus {
        outline: none;
        border-color: var(--accent);
    }

    #agg-indicator {
        font-size: 0.75rem;
        padding: 5px 10px;
        border-radius: 6px;
        background: var(--surface-2);
        border: 1px solid var(--border);
        font-weight: 600;
    }

    /* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hbtn {
        padding: 7px 14px;
        border-radius: var(--radius-sm);
        font-size: 0.82rem;
        font-weight: 500;
        cursor: pointer;
        border: 1px solid var(--border);
        background: var(--surface-2);
        color: var(--text);
        transition: all 0.15s;
    }

    .hbtn:hover {
        background: var(--surface);
        border-color: rgba(255, 255, 255, 0.15);
    }

    .hbtn-danger {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: var(--red);
    }

    .hbtn-danger:hover {
        background: rgba(239, 68, 68, 0.2);
    }

    .hbtn-success {
        background: rgba(34, 197, 94, 0.1);
        border-color: rgba(34, 197, 94, 0.3);
        color: var(--green);
    }

    .hbtn-success:hover {
        background: rgba(34, 197, 94, 0.2);
    }

    .hbtn-accent {
        background: var(--accent-dim);
        border-color: rgba(168, 85, 247, 0.35);
        color: var(--accent);
    }

    .hbtn-accent:hover {
        background: rgba(168, 85, 247, 0.2);
    }

    /* â”€â”€ Main Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .v74-main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 28px 24px;
    }

    /* â”€â”€ Metric Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .metric-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 14px;
        margin-bottom: 20px;
    }

    @media (max-width: 900px) {
        .metric-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 520px) {
        .metric-grid {
            grid-template-columns: 1fr;
        }
    }

    .metric-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 22px 20px;
        position: relative;
        overflow: hidden;
        transition: border-color 0.2s;
    }

    .metric-card:hover {
        border-color: rgba(168, 85, 247, 0.3);
    }

    .metric-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--accent), transparent);
        opacity: 0.3;
    }

    .metric-label {
        font-size: 0.72rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        margin-bottom: 10px;
    }

    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        letter-spacing: -0.02em;
        line-height: 1;
        margin-bottom: 8px;
    }

    .metric-sub {
        font-size: 0.78rem;
        color: var(--text-dim);
    }

    .metric-sub strong {
        color: var(--text);
    }

    .text-green {
        color: var(--green);
    }

    .text-red {
        color: var(--red);
    }

    .text-accent {
        color: var(--accent);
    }

    .text-dim {
        color: var(--text-dim);
    }

    /* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .v74-card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        margin-bottom: 14px;
        overflow: hidden;
    }

    .v74-card-head {
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border);
    }

    .v74-card-title {
        font-size: 0.82rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        color: var(--text-dim);
    }

    .v74-card-body {
        padding: 20px;
    }

    /* â”€â”€ Tables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .v74-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.83rem;
    }

    .v74-table th {
        text-align: left;
        padding: 8px 12px;
        color: var(--text-dim);
        font-weight: 600;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border-bottom: 1px solid var(--border);
    }

    .v74-table td {
        padding: 10px 12px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        vertical-align: middle;
    }

    .v74-table tr:hover td {
        background: rgba(255, 255, 255, 0.02);
    }

    .v74-table tr:last-child td {
        border-bottom: none;
    }

    /* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tag {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 6px;
        font-size: 0.72rem;
        font-weight: 600;
    }

    .tag-green {
        background: rgba(34, 197, 94, 0.12);
        color: var(--green);
    }

    .tag-red {
        background: rgba(239, 68, 68, 0.12);
        color: var(--red);
    }

    .tag-orange {
        background: rgba(245, 158, 11, 0.12);
        color: var(--orange);
    }

    .tag-blue {
        background: rgba(99, 102, 241, 0.12);
        color: #818cf8;
    }

    .tag-gray {
        background: rgba(255, 255, 255, 0.06);
        color: var(--text-dim);
    }

    /* â”€â”€ Accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .accordion-trigger {
        cursor: pointer;
        user-select: none;
    }

    .accordion-trigger .chevron {
        transition: transform 0.2s;
        display: inline-block;
    }

    .accordion-trigger.open .chevron {
        transform: rotate(180deg);
    }

    .accordion-body {
        display: none;
    }

    .accordion-body.open {
        display: block;
    }

    /* â”€â”€ AI Reco Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .reco-card {
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        padding: 14px 16px;
        margin-bottom: 10px;
        border-left: 3px solid var(--border);
    }

    .reco-card.up {
        border-left-color: var(--green);
    }

    .reco-card.down {
        border-left-color: var(--red);
    }

    .reco-card.hold {
        border-left-color: var(--text-dim);
    }

    .reco-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }

    .reco-param {
        font-weight: 600;
        font-size: 0.85rem;
    }

    .reco-values {
        font-size: 0.78rem;
        color: var(--text-dim);
        margin-bottom: 8px;
    }

    .reco-reasoning {
        font-size: 0.78rem;
        color: var(--text-dim);
        line-height: 1.5;
    }

    /* â”€â”€ Apply All button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-apply-all {
        width: 100%;
        padding: 12px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        border: 1px solid rgba(168, 85, 247, 0.4);
        background: rgba(168, 85, 247, 0.12);
        color: var(--accent);
        transition: all 0.2s;
        margin-top: 8px;
    }

    .btn-apply-all:hover {
        background: rgba(168, 85, 247, 0.22);
        box-shadow: 0 0 20px rgba(168, 85, 247, 0.15);
    }

    /* â”€â”€ Live Config Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .config-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }

    @media (max-width: 600px) {
        .config-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .config-item {
        background: var(--surface-2);
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        padding: 10px 12px;
    }

    .config-key {
        font-size: 0.68rem;
        text-transform: uppercase;
        letter-spacing: 0.07em;
        color: var(--text-dim);
        margin-bottom: 4px;
    }

    .config-val {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--accent);
    }

    /* â”€â”€ Filters â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filter-row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.78rem;
        font-weight: 500;
        cursor: pointer;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text-dim);
        transition: all 0.15s;
    }

    .filter-btn.active,
    .filter-btn:hover {
        background: var(--accent-dim);
        border-color: rgba(168, 85, 247, 0.4);
        color: var(--accent);
    }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .v74-footer {
        border-top: 1px solid var(--border);
        padding: 18px 28px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 28px;
        font-size: 0.78rem;
        color: var(--text-dim);
        flex-wrap: wrap;
        gap: 10px;
    }

    .v74-footer a {
        color: var(--text-dim);
        text-decoration: none;
    }

    .v74-footer a:hover {
        color: var(--text);
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast-container {
        position: fixed;
        top: 20px;
        right: 24px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .toast {
        padding: 12px 18px;
        border-radius: var(--radius-sm);
        font-size: 0.84rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        backdrop-filter: blur(10px);
        animation: slideIn 0.25s ease;
        max-width: 320px;
    }

    .toast-success {
        background: rgba(34, 197, 94, 0.12);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: var(--green);
    }

    .toast-error {
        background: rgba(239, 68, 68, 0.12);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: var(--red);
    }

    .toast-info {
        background: rgba(168, 85, 247, 0.12);
        border: 1px solid rgba(168, 85, 247, 0.3);
        color: var(--accent);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1
        }

        50% {
            opacity: .35
        }
    }

    .two-col {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 14px;
    }

    @media (max-width: 800px) {
        .two-col {
            grid-template-columns: 1fr;
        }
    }

    select option {
        background: #18181c;
    }
</style>

<!-- Toast container -->
<div id="toast-container"></div>

<!-- â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â• -->
<header class="v74-header">
    <div class="v74-logo">
        <div class="v74-logo-mark">ğŸ¤–</div>
        <span class="v74-logo-text">Polymarket Bot</span>
        <span class="v74-logo-ver">V7.5</span>
    </div>
    <div class="v74-header-right">
        <a href="/copy-trading"
            style="color:var(--accent);font-size:0.82rem;font-weight:600;text-decoration:none;padding:5px 10px;border-radius:8px;border:1px solid rgba(168,85,247,0.2);background:rgba(168,85,247,0.06);">ğŸ“‹
            Copy Trading</a>
        <div class="live-badge" id="bot-status-badge">
            <span class="live-dot"></span> Bot actif Â· 8s
        </div>
        <!-- V8.0 STRATEGY SELECTOR -->
        <div class="agg-select-wrap">
            <span class="agg-badge" style="background:var(--accent);color:black;">MODE</span>
            <select id="strategy-select" onchange="setStrategy(this.value)"
                style="font-weight:bold; color:var(--accent);">
                <option value="Info Edge Only">âš¡ Info Edge Only</option>
                <option value="MM Conservateur">ğŸ›¡ï¸ MM Conservateur</option>
                <option value="MM Balanced" selected>âš–ï¸ MM Balanced</option>
                <option value="MM Aggressif">ğŸ”¥ MM Aggressif</option>
                <option value="MM TrÃ¨s Agressif">ğŸš€ MM TrÃ¨s Aressif</option>
            </select>
        </div>
        <div id="strategy-display" class="tag tag-blue"
            style="font-size: 0.9rem; padding: 6px 12px; border-radius: 6px;">StratÃ©gie : MM Balanced âœ…</div>

        <!-- Kill Switch -->
        <button class="hbtn hbtn-danger" id="btn-kill" onclick="toggleBot('kill')">â¹ Kill</button>
        <button class="hbtn hbtn-success" id="btn-resume" onclick="toggleBot('resume')" style="display:none">â–¶
            Resume</button>
        <!-- V7.7 Factory Reset -->
        <button class="hbtn hbtn-danger" onclick="factoryReset()"
            style="margin-left:8px; border-color:var(--red); color:var(--red); background:rgba(239,68,68,0.1);">ğŸ”„
            Factory Reset</button>
        <a href="{{ url_for('logout') }}" class="hbtn" style="margin-left:8px;">Logout</a>
    </div>
</header>

<!-- â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â• -->
<main class="v74-main">

    <!-- V8.2 Info Edge ENFORCED Banner -->
    <div id="info-edge-card"
        style="display:none; background:rgba(239,68,68,0.12); border:2px solid #ef4444; color:#ef4444; padding:12px 20px; border-radius:10px; margin-bottom:15px; font-weight:700; font-size:1.05rem; text-align:center; letter-spacing:0.5px;">
        âš¡ INFO EDGE ONLY ENFORCED â€” Universe limitÃ© BTC/ETH 5-60min uniquement, OBI dÃ©sactivÃ©
    </div>

    <!-- â”€â”€ METRIC CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="metric-grid" id="portfolio-panel">
        <div class="metric-card">
            <div class="metric-label">Total Portfolio</div>
            <div class="metric-value" id="val-total">
                ${{ "%.2f"|format(portfolio_val) if portfolio_val is not none else "0.00" }}
            </div>
            <div class="metric-sub">Cash: <strong id="val-cash">${{ "%.2f"|format(cash) if cash is not none else "0.00"
                    }}</strong></div>
        </div>
        <div class="metric-card">
            <div class="metric-label">High Water Mark</div>
            <div class="metric-value" id="val-hwm">
                ${{ "%.2f"|format(hwm) if hwm is not none else "0.00" }}
            </div>
            <div class="metric-sub" id="val-hwm-pct">
                <span class="{{ 'text-green' if hwm_pct >= 0 else 'text-red' }}">
                    {{ "+" if hwm_pct > 0 else "" }}{{ "%.2f"|format(hwm_pct) if hwm_pct is not none else "0.00" }}% vs
                    HWM
                </span>
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">PnL du Jour</div>
            <div class="metric-value {{ 'text-green' if pnl_today >= 0 else 'text-red' }}" id="val-pnl-today">
                {{ "+" if pnl_today > 0 else "" }}${{ "%.2f"|format(pnl_today|abs) if pnl_today is not none else "0.00"
                }}
            </div>
            <div class="metric-sub" id="val-pnl-week">
                <span class="{{ 'text-green' if pnl_week >= 0 else 'text-red' }}">
                    {{ "+" if pnl_week > 0 else "" }}${{ "%.2f"|format(pnl_week|abs) if pnl_week is not none else "0.00"
                    }}
                </span> sur 7j
            </div>
        </div>
        <div class="metric-card">
            <div class="metric-label">Total PnL</div>
            <div class="metric-value {{ 'text-green' if total_pnl >= 0 else 'text-red' }}" id="val-pnl-total">
                {{ "+" if total_pnl > 0 else "" }}${{ "%.2f"|format(total_pnl|abs) if total_pnl is not none else "0.00"
                }}
            </div>
            <div class="metric-sub">Win Rate: <strong class="text-accent" id="val-winrate">--</strong></div>
        </div>
    </div>

    <div class="two-col">
        <!-- LEFT COLUMN -->
        <div>

            <!-- â”€â”€ POSITIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="v74-card">
                <div class="v74-card-head">
                    <span class="v74-card-title">ğŸ“Š Positions en cours</span>
                    <button class="hbtn" onclick="loadPositions()">âŸ³ Refresh</button>
                </div>
                <div style="overflow-x:auto;">
                    <table class="v74-table">
                        <thead>
                            <tr>
                                <th>MarchÃ©</th>
                                <th>Qty</th>
                                <th>Avg</th>
                                <th>Mid</th>
                                <th>Valeur</th>
                                <th>PnL</th>
                                <th>Expo</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="positions-tbody">
                            <tr>
                                <td colspan="8" style="text-align:center;color:var(--text-dim);padding:24px">
                                    Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- â”€â”€ TRADE HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="v74-card">
                <div class="v74-card-head">
                    <span class="v74-card-title">ğŸ’¹ Historique des trades</span>
                    <div class="filter-row">
                        <button class="filter-btn active" onclick="loadTrades(50, this)">50</button>
                        <button class="filter-btn" onclick="loadTrades(200, this)">200</button>
                        <button class="filter-btn" onclick="loadTrades(500, this)">500</button>
                    </div>
                </div>
                <div style="overflow-x:auto; max-height:320px; overflow-y:auto;">
                    <table class="v74-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>MarchÃ©</th>
                                <th>Side</th>
                                <th>Qty</th>
                                <th>Ouv.</th>
                                <th>ClÃ´t.</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody id="trades-tbody">
                            <tr>
                                <td colspan="7" style="text-align:center;color:var(--text-dim);padding:24px">
                                    Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- â”€â”€ PERFORMANCE CHART â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="v74-card">
                <div class="v74-card-head">
                    <span class="v74-card-title">ğŸ“ˆ Performance CumulÃ©e (USDC)</span>
                    <span class="tag tag-gray" id="perf-period">7 derniers jours</span>
                </div>
                <div class="v74-card-body" style="padding:12px 16px;">
                    <div id="perf-chart" style="height:240px;"></div>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN -->
        <div>

            <!-- â”€â”€ LIVE CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="v74-card">
                <div class="v74-card-head">
                    <span class="v74-card-title">âš¡ Config Live Bot</span>
                    <span class="tag tag-blue" id="cfg-level">Balanced</span>
                </div>
                <div class="v74-card-body">
                    <div class="config-grid" id="live-config-panel">
                        <div class="config-item">
                            <div class="config-key">order_size_pct</div>
                            <div class="config-val" id="cfg-order-size">--</div>
                        </div>
                        <div class="config-item">
                            <div class="config-key">max_expo</div>
                            <div class="config-val" id="cfg-max-expo">--</div>
                        </div>
                        <div class="config-item">
                            <div class="config-key">skew_thresh</div>
                            <div class="config-val" id="cfg-skew">--</div>
                        </div>
                        <div class="config-item">
                            <div class="config-key">sizing_mult</div>
                            <div class="config-val" id="cfg-sizing">--</div>
                        </div>
                        <div class="config-item">
                            <div class="config-key">max_order $</div>
                            <div class="config-val" id="cfg-max-order">--</div>
                        </div>
                        <div class="config-item">
                            <div class="config-key">status</div>
                            <div class="config-val" style="font-size:0.8rem;color:var(--green)">â— live</div>
                        </div>
                    </div>
                    <p style="font-size:0.7rem;color:var(--text-dim);margin-top:10px;text-align:right">RafraÃ®chi toutes
                        les 10s</p>
                </div>
            </div>

            <!-- â”€â”€ AI STRATEGY REVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
            <div class="v74-card">
                <div class="v74-card-head accordion-trigger" id="ai-accordion-trigger" onclick="toggleAccordion()">
                    <span class="v74-card-title">ğŸ¤– AI Strategy Review</span>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <span class="tag tag-gray" id="ai-last-run" style="font-size:0.68rem">--</span>
                        <span class="chevron" style="color:var(--text-dim);font-size:1rem;">â–¾</span>
                    </div>
                </div>
                <div class="accordion-body open" id="ai-accordion-body">
                    <div class="v74-card-body" style="padding-bottom:8px;">
                        <div id="ai-stats"
                            style="background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);padding:10px 14px;font-size:0.8rem;margin-bottom:12px;">
                        </div>
                        <div id="ai-recs-container">
                            <p style="color:var(--text-dim);text-align:center;padding:20px 0;font-size:0.85rem;">Analyse
                                en cours...</p>
                        </div>
                        <button class="btn-apply-all" onclick="applyAllAiRecs()">ğŸš€ Appliquer TOUTES les recommandations
                            AI</button>
                        <button class="hbtn" style="width:100%;justify-content:center;margin-top:8px;"
                            onclick="loadAIReview()">ğŸ”„ Relancer l'Analyse</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

</main>

<!-- â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â• -->
<footer class="v74-footer">
    <div>Polymarket Bot V7.4 â€” {{ "Simulation" if False else "Live" }} Mode</div>
    <div style="display:flex;gap:16px;">
        <a href="/logs" target="_blank">ğŸ“‹ Logs</a>
        <a href="https://github.com/Mick-fr/polymarket-bot" target="_blank">ğŸ™ GitHub</a>
        <a href="/health">ğŸ’š Health</a>
    </div>
</footer>

<script>
    // â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toast(msg, type = 'success') {
        const d = document.createElement('div');
        d.className = `toast toast-${type}`;
        d.innerHTML = msg;
        document.getElementById('toast-container').appendChild(d);
        setTimeout(() => d.remove(), 3500);
    }

    function fmtUsd(v) {
        if (v == null) return '--';
        const n = parseFloat(v);
        const sign = n < 0 ? '-' : n > 0 ? '+' : '';
        const cls = n < 0 ? 'text-red' : n > 0 ? 'text-green' : '';
        return `<span class="${cls}">${sign}$${Math.abs(n).toFixed(2)}</span>`;
    }
    function fmtPct(v) {
        if (v == null) return '--';
        const n = parseFloat(v);
        const cls = n < 0 ? 'text-red' : 'text-green';
        return `<span class="${cls}">${n > 0 ? '+' : ''}${n.toFixed(2)}%</span>`;
    }

    // â”€â”€ Portfolio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadPortfolio() {
        fetch('/api/v73/portfolio').then(r => r.json()).then(d => {
            if (!d) return;
            document.getElementById('val-total').textContent = '$' + (d.portfolio_val || 0).toFixed(2);
            document.getElementById('val-cash').textContent = '$' + (d.cash || 0).toFixed(2);
            document.getElementById('val-hwm').textContent = '$' + (d.hwm || 0).toFixed(2);
            if (d.hwm_pct != null) {
                const p = d.hwm_pct; const cls = p >= 0 ? 'text-green' : 'text-red';
                document.getElementById('val-hwm-pct').innerHTML = `<span class="${cls}">${p >= 0 ? '+' : ''}${p.toFixed(2)}% vs HWM</span>`;
            }
            document.getElementById('val-pnl-today').innerHTML = fmtUsd(d.pnl_today);
            document.getElementById('val-pnl-week').innerHTML = fmtUsd(d.pnl_week) + ' sur 7j';
            document.getElementById('val-pnl-total').innerHTML = fmtUsd(d.total_pnl);
            if (d.win_rate != null) document.getElementById('val-winrate').textContent = d.win_rate.toFixed(0) + '%';
            // Kill switch state
            const ks = d.kill_switch;
            document.getElementById('btn-kill').style.display = ks ? 'none' : 'inline-flex';
            document.getElementById('btn-resume').style.display = ks ? 'inline-flex' : 'none';
            const badge = document.getElementById('bot-status-badge');
            if (ks) { badge.style.borderColor = 'rgba(239,68,68,0.3)'; badge.style.background = 'rgba(239,68,68,0.08)'; badge.style.color = 'var(--red)'; badge.innerHTML = '<span style="width:7px;height:7px;border-radius:50%;background:var(--red);display:inline-block"></span> Bot arrÃªtÃ©'; }
            else { badge.style.borderColor = 'rgba(34,197,94,0.2)'; badge.style.background = 'rgba(34,197,94,0.08)'; badge.style.color = 'var(--green)'; badge.innerHTML = '<span class="live-dot"></span> Bot actif Â· 8s'; }
        }).catch(() => { });
    }

    // â”€â”€ Positions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadPositions() {
        fetch('/api/v73/positions').then(r => r.json()).then(list => {
            const tbody = document.getElementById('positions-tbody');
            if (!list || list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--text-dim);padding:24px">Inventaire vide</td></tr>';
                return;
            }
            tbody.innerHTML = list.map(p => `
        <tr>
          <td style="max-width:160px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${p.question}">${(p.question || '').slice(0, 40)}</td>
          <td>${parseFloat(p.quantity || 0).toFixed(2)}</td>
          <td>$${parseFloat(p.avg_price || 0).toFixed(3)}</td>
          <td>$${parseFloat(p.mid || 0).toFixed(3)}</td>
          <td><strong>$${parseFloat(p.value || 0).toFixed(2)}</strong></td>
          <td>${fmtUsd(p.pnl_usd)}</td>
          <td>${fmtPct(p.skew_pct)}</td>
          <td><button class="hbtn hbtn-danger" style="font-size:0.72rem;padding:3px 8px" onclick="rebalanceToken('${p.token_id}')">Sell 50%</button></td>
        </tr>`).join('');
        }).catch(() => { });
    }

    // â”€â”€ Trades â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadTrades(limit, btn) {
        if (btn) { document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        fetch(`/api/v73/trades?limit=${limit}`).then(r => r.json()).then(data => {
            const tbody = document.getElementById('trades-tbody');
            const list = data.trades || data;
            if (!list || list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--text-dim);padding:24px">Aucun trade</td></tr>'; return;
            }
            tbody.innerHTML = list.map(t => {
                const pnl = t.pnl_usdc; const cls = pnl > 0 ? 'text-green' : pnl < 0 ? 'text-red' : '';
                const ts = (t.close_timestamp || t.timestamp || '').slice(0, 16).replace('T', ' ');
                return `<tr>
          <td style="font-size:0.75rem;color:var(--text-dim)">${ts}</td>
          <td style="max-width:120px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${t.question || ''}">${(t.question || t.token_id || '').slice(0, 28)}</td>
          <td><span class="tag ${t.side === 'buy' ? 'tag-green' : 'tag-red'}">${(t.side || '').toUpperCase()}</span></td>
          <td>${parseFloat(t.quantity || 0).toFixed(2)}</td>
          <td>$${parseFloat(t.open_price || t.avg_price || 0).toFixed(3)}</td>
          <td>${t.close_price != null ? '$' + parseFloat(t.close_price).toFixed(3) : '--'}</td>
          <td><span class="${cls}">${pnl != null ? (pnl >= 0 ? '+' : '') + '$' + Math.abs(pnl).toFixed(2) : '--'}</span></td>
        </tr>`;
            }).join('');
        }).catch(() => { });
    }

    // â”€â”€ AI Review â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadAIReview() {
        document.getElementById('ai-recs-container').innerHTML = '<p style="color:var(--text-dim);text-align:center;padding:20px 0;font-size:0.85rem;">Analyse en cours...</p>';
        fetch('/api/v73/ai-review').then(r => r.json()).then(data => {
            const ts = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('ai-last-run').textContent = 'Ã  ' + ts;
            if (data.stats) {
                const s = data.stats;
                document.getElementById('ai-stats').innerHTML = `
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;font-size:0.78rem;text-align:center;">
            <div><div style="color:var(--text-dim);margin-bottom:2px">Trades</div><strong>${s.total_trades || 0}</strong></div>
            <div><div style="color:var(--text-dim);margin-bottom:2px">Win Rate</div><strong class="${(s.win_rate || 0) >= 50 ? 'text-green' : 'text-red'}">${(s.win_rate || 0).toFixed(0)}%</strong></div>
            <div><div style="color:var(--text-dim);margin-bottom:2px">Avg PnL</div><strong>${fmtUsd(s.avg_pnl)}</strong></div>
            <div><div style="color:var(--text-dim);margin-bottom:2px">Sharpe</div><strong class="text-accent">${(s.sharpe || 0).toFixed(2)}</strong></div>
          </div>`;
            }
            const recs = data.recommendations || [];
            if (!recs.length) {
                document.getElementById('ai-recs-container').innerHTML = '<p style="color:var(--text-dim);text-align:center;padding:16px 0;font-size:0.85rem;">âœ… StratÃ©gie optimale â€” aucune recommandation</p>';
                return;
            }
            document.getElementById('ai-recs-container').innerHTML = recs.map(r => {
                const cls = r.direction === 'augmenter' ? 'up' : r.direction === 'reduire' ? 'down' : 'hold';
                const tag = r.direction === 'augmenter' ? 'tag-green' : r.direction === 'reduire' ? 'tag-red' : 'tag-gray';
                const applyBtn = r.direction !== 'maintenir' && r.recommended_value != null
                    ? `<button class="hbtn" style="font-size:0.72rem;padding:4px 10px;margin-top:6px" onclick="applyAiRec('${r.parameter}',${r.recommended_value})">Appliquer ce paramÃ¨tre</button>`
                    : '';
                return `<div class="reco-card ${cls}">
          <div class="reco-header">
            <span class="reco-param">${r.parameter}</span>
            <span class="tag ${tag}">${(r.direction || '').toUpperCase()}</span>
          </div>
          <div class="reco-values">Actuel : <strong style="color:var(--text)">${r.current_value}</strong> â†’ RecommandÃ© : <strong style="color:var(--accent)">${r.recommended_value ?? '--'}</strong></div>
          <div class="reco-reasoning">${r.reasoning || ''}</div>
          ${applyBtn}
        </div>`;
            }).join('');
        }).catch(() => {
            document.getElementById('ai-recs-container').innerHTML = '<p style="color:var(--red);text-align:center;padding:16px">Erreur lors de l\'analyse</p>';
        });
    }

    // â”€â”€ Accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleAccordion() {
        const trigger = document.getElementById('ai-accordion-trigger');
        const body = document.getElementById('ai-accordion-body');
        trigger.classList.toggle('open');
        body.classList.toggle('open');
    }

    // â”€â”€ Kill Switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleBot(action) {
        fetch('/' + action, { method: 'POST' })
            .then(() => { setTimeout(loadPortfolio, 500); toast(action === 'kill' ? 'â¹ Bot arrÃªtÃ©' : 'â–¶ Bot redÃ©marrÃ©', action === 'kill' ? 'error' : 'success'); });
    }

    // â”€â”€ V8.1 Strategy Selector â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setStrategy(mode) {
        const ind = document.getElementById('strategy-display');
        ind.textContent = 'â³ ...';
        fetch('/api/set-strategy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mode })
        }).then(r => r.json()).then(d => {
            if (d.status === 'ok') {
                if (d.mode === 'Info Edge Only') {
                    toast('âš¡ <strong>Info Edge Only activÃ©</strong> â€” seulement BTC/ETH 5-60min, OBI dÃ©sactivÃ©', 'success');
                } else {
                    toast(`ğŸ¯ StratÃ©gie â†’ <strong>${d.mode}</strong> activÃ©e`, 'info');
                }
                setTimeout(syncLiveConfig, 400);
            } else {
                toast('âŒ ' + (d.error || 'Erreur'), 'error');
                syncLiveConfig();
            }
        }).catch(() => toast('âŒ Erreur rÃ©seau', 'error'));
    }

    // 2026 V7.7 â€” Factory Reset Complet
    function factoryReset() {
        var msg = "âš ï¸ ATTENTION DANGER âš ï¸\n\nÃŠtes-vous sÃ»r ? Cela vendra virtuellement TOUTES les positions, effacera tout l'historique copy, videra les journaux et remettra votre HWM au solde actuel.\n\nTapez 'RESET' en majuscules pour confirmer :";
        var promptVal = prompt(msg);
        if (promptVal !== "RESET") {
            if (promptVal !== null) {
                alert("AnnulÃ© : phrase de confirmation incorrecte.");
            }
            return;
        }

        toast('DÃ©marrage du Factory Reset...', 'info');
        fetch('/api/factory-reset', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ confirm_phrase: 'RESET' })
        })
            .then(r => r.json())
            .then(d => {
                if (d.status === 'ok') {
                    alert("âœ… Factory Reset terminÃ© avec succÃ¨s. RedÃ©marrage de la page...");
                    window.location.reload();
                } else {
                    toast("Erreur Factory Reset: " + (d.message || d.error), 'error');
                }
            })
            .catch(e => toast('Erreur de connexion', 'error'));
    }

    // â”€â”€ Apply AI Rec â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyAiRec(param, val) {
        if (!confirm(`Appliquer ${param} = ${val} et redÃ©marrer le bot ?`)) return;
        fetch('/api/v73/apply-rec', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ parameter: param, value: val })
        }).then(() => { toast(`âœ… ${param} = ${val} appliquÃ© â€” bot redÃ©marre`, 'success'); setTimeout(syncLiveConfig, 500); });
    }

    // â”€â”€ Apply ALL Recs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function applyAllAiRecs() {
        if (!confirm('ğŸš€ Appliquer TOUTES les recommandations AI et redÃ©marrer le bot ?')) return;
        fetch('/api/v73/apply-all-recs', { method: 'POST' })
            .then(r => r.json())
            .then(d => {
                if (d.status === 'ok') {
                    toast(`âœ… ${d.applied_count} recommandations appliquÃ©es â€” bot redÃ©marre`, 'success');
                    setTimeout(syncLiveConfig, 600);
                    setTimeout(loadPortfolio, 800);
                } else toast('âŒ ' + (d.error || 'Erreur'), 'error');
            }).catch(() => toast('âŒ Erreur rÃ©seau', 'error'));
    }

    // â”€â”€ Rebalance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function rebalanceToken(tokenId) {
        if (!confirm('Forcer un SELL 50% sur ce token au prochain cycle ?')) return;
        fetch('/api/v73/rebalance/' + tokenId, { method: 'POST' })
            .then(() => toast('âš–ï¸ Ordre rebalance envoyÃ©', 'info'));
    }

    // â”€â”€ Sync Live Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function syncLiveConfig() {
        fetch('/api/bot-status').then(r => r.json()).then(d => {
            const mode = d.strategy_mode || 'MM Balanced';

            // Update Select
            const sel = document.getElementById('strategy-select');
            if (sel) { sel.value = mode; }

            // Update display banner
            const ind = document.getElementById('strategy-display');
            if (ind) {
                if (mode === 'Info Edge Only') {
                    ind.textContent = 'INFO EDGE ONLY ENFORCED âš¡';
                    ind.className = 'tag tag-red';
                    ind.style.color = '#ef4444';
                } else {
                    ind.textContent = `StratÃ©gie : ${mode} âœ…`;
                    ind.style.color = '';
                    if (mode === 'MM TrÃ¨s Agressif') ind.className = 'tag tag-red';
                    else if (mode === 'MM Aggressif') ind.className = 'tag tag-orange';
                    else ind.className = 'tag tag-blue';
                }
            }

            // Show/Hide Info Edge ENFORCED banner
            const ieCard = document.getElementById('info-edge-card');
            if (ieCard) {
                ieCard.style.display = (mode === 'Info Edge Only') ? 'block' : 'none';
            }

        }).catch(() => { });

        // Update stats panel values by fetching /api/current-config
        fetch('/api/current-config').then(r => r.json()).then(cfg => {
            document.getElementById('cfg-level').textContent = cfg.strategy_mode || 'MM Balanced';
            document.getElementById('cfg-order-size').textContent = ((cfg.order_size_pct || 0) * 100).toFixed(1) + '%';
            document.getElementById('cfg-max-expo').textContent = ((cfg.max_net_exposure_pct || 0) * 100).toFixed(0) + '%';
            document.getElementById('cfg-skew').textContent = (cfg.inventory_skew_threshold || 0).toFixed(2);
            document.getElementById('cfg-sizing').textContent = (cfg.sizing_mult || 1).toFixed(2) + 'Ã—';
            document.getElementById('cfg-max-order').textContent = '$' + (cfg.max_order_usd || 15).toFixed(0);
        }).catch(() => { });
    }



    // â”€â”€ Performance Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadPerfChart() {
        fetch('/api/v73/cumulative-pnl').then(r => r.json()).then(data => {
            if (!data || !data.length) return;
            const labels = data.map(d => d.date || d.timestamp || '');
            const vals = data.map(d => d.cumulative_pnl || d.pnl || 0);
            const last = vals[vals.length - 1] || 0;
            const color = last >= 0 ? '#22c55e' : '#ef4444';
            const ctx = document.getElementById('perf-chart');
            if (!ctx) return;
            if (window.perfChart) window.perfChart.destroy();
            window.perfChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets: [{ label: 'PnL CumulÃ© (USDC)', data: vals, borderColor: color, borderWidth: 2, fill: true, backgroundColor: color.replace(')', ',0.07)').replace('rgb', 'rgba'), tension: 0.35, pointRadius: 0 }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: c => '$' + c.parsed.y.toFixed(2) } } },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.03)' }, ticks: { color: '#666', font: { size: 10 }, maxTicksLimit: 7 } },
                        y: { grid: { color: 'rgba(255,255,255,0.04)' }, ticks: { color: '#666', font: { size: 10 }, callback: v => '$' + v.toFixed(0) } }
                    }
                }
            });
        }).catch(() => { });
    }

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', () => {
        loadPortfolio();
        loadPositions();
        loadTrades(50);
        loadAIReview();
        syncLiveConfig();
        // Load Chart.js dynamically then draw perf chart
        const s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
        s.onload = loadPerfChart;
        document.head.appendChild(s);
    });

    // Auto-refresh
    setInterval(loadPortfolio, 15000);
    setInterval(loadPositions, 20000);
    setInterval(syncLiveConfig, 10000);
</script>
{% endblock %}